---
title: "Exercise"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## green buildings
We found many flaws in the analysis done by the "excel guru". We disagree with his figures as he only took the median of rent from both non-green and green building, then use the differences between the two to calculate extra revenue. He did not consider other factors that might be affecting the relationship between rent and green status which make his calculation inefficient. Furthermore, he only took into account the initial cost of 100 mil and the 5% premium, without considering other cost-benefits such as savings on electrcity and gas usage in a green building. Next we will show some analysis we did to look for confounding variables.

```{r}
library(dplyr)
library(ggplot2)
library(tidyverse)
library(ggalt)
gb = read.csv("greenbuildings.csv")
gb$net = as.factor(gb$net)
gb$green_rating = as.factor(gb$green_rating)
gb$LEED = as.factor(gb$LEED)
gb$Energystar = as.factor(gb$Energystar)
gb$renovated = as.factor(gb$renovated)
gb$class_a = as.factor(gb$class_a)
avg_age = median(gb[gb$green_rating == 1,]$age)
```

Here, we are doing some data exploratory analysis on the dataset to discover trends and correlations.
```{r}
theme_set(theme_classic())

g1 <- ggplot(gb, aes(Rent)) + scale_fill_brewer(palette = "Spectral") +                geom_histogram(aes(fill=stories),binwidth = 2, 
                   col="black", 
                   size=.1)

g1 + facet_wrap( ~ green_rating) + 
    labs(title="Distribution of rent across all buildings", y="Number of buildings", x="Rent")

# Zoom in without deleting the points outside the limits.
g1 + facet_wrap( ~ green_rating) + coord_cartesian(xlim=c(0,100)) +
    labs(title="Distribution of rent across all buildings", subtitle="Rent below $100",
    y="Number of buildings", x="Rent")

# Zoom in to take a look at the extreme case.
g1 + facet_wrap( ~ green_rating) + coord_cartesian(xlim=c(100,300),ylim=c(0,25)) +
  labs(title="Distribution of rent across all buildings", subtitle="Rent above $100",
    y="Number of buildings", x="Rent")

g2 <- ggplot(gb, aes(leasing_rate)) + scale_fill_brewer(palette = "Spectral") +                geom_density(aes(fill=factor(green_rating)), alpha=0.8)
g2 + facet_wrap( ~ green_rating) + 
    labs(title="Distribution of leasing rate across all buildings", y="Density", x="Leasing Rate")


# There are many factors that can have an effect on rent, like location, building quality, appliances and Other amenities, tenant/use mix, etc. Now we know that the target project is a new 15-story mixed-use building on East Cesar Chavez, just across I-35 from downtown. Since we have story information in the dataset, let's focus on the situation of 15-story buildings.

# From the graphic, we can conclude that among 15-story building:
# 1.the average rent of green buildings is higher than that of non-green buildings;
# 2.the average occupancy rate of green buildings is higher than that of non-green buildings;
# 3.all green buildings have a class of a or b (however, does this bring extra cost)?


story15 = dplyr::filter(gb,stories==15)
story15.class = story15 %>% filter(class_a == 0 & class_b == 0)

theme_set(theme_bw())
g3 <- ggplot(story15, aes(leasing_rate,Rent))
g3 + geom_point(aes(col=green_rating, size=age)) + 
     geom_encircle(aes(x=leasing_rate, y=Rent), 
                data=story15.class, 
                color="red", 
                size=2, 
                expand=0.08)
```

Here, we analyzed some variables that might be affecting the relationship between green status and rent.
```{r}
#From this plot we can see that a majority of the green buildings are of class a
classa_b = ggplot(data=gb) + geom_bar(mapping = aes(x=class_a, fill = green_rating),stat="count",position = "dodge")
classa_b

#Then we dived in on the relationship between class a and rent specifically and saw that class a building generally have a higher rent
all_class = ggplot(data=gb) + geom_boxplot(mapping = aes(x=class_a,y=Rent))
all_class

#Since most green buildings are of class a, class a can be a confounding variable that is also a part of the reason why rent increases in respect to green status. To adjust that, we can focus on buildings that are of class a ony, and compute median rent from those buildings. 

all_size = ggplot(data=gb) + geom_line(mapping = aes(x=size,y=Rent))
all_size
```

#might delete 
```{r}
med_age_green = median(gb[gb$green_rating == 1,]$age)
new_building = gb %>% filter(age < med_age_green)
old_building =gb %>% filter(age >= med_age_green)

#based on these plots, we saw that a new green building has a slightly lower rent then non-green buildings, but as age increase green buildings rent became higher then the non-green building
new = ggplot(data=new_building,aes(x=green_rating, y=Rent)) + geom_boxplot()  
old = ggplot(data=old_building,aes(x=green_rating, y=Rent)) + geom_boxplot() 

new
old

#taking a closer look at the specific value, rent for green increases until around the median age of 22 then it decreases slightly but still higher then when its new
new_rent_ng = median(new_building[new_building$green_rating == 0,]$Rent)#28.8
old_rent_ng = median(old_building[old_building$green_rating == 0,]$Rent)#24.27
new_rent_g = median(new_building[new_building$green_rating == 1,]$Rent)#28.2
old_rent_g = median(old_building[old_building$green_rating == 1,]$Rent)#27
```

```{r}


```


